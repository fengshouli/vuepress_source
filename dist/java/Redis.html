<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 冯手力-java学习之路</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.1c15f983.css" as="style"><link rel="preload" href="/assets/js/app.18fa8910.js" as="script"><link rel="preload" href="/assets/js/2.d4087e47.js" as="script"><link rel="preload" href="/assets/js/9.3ca4f0e3.js" as="script"><link rel="prefetch" href="/assets/js/10.0e30a326.js"><link rel="prefetch" href="/assets/js/11.dd81c618.js"><link rel="prefetch" href="/assets/js/12.bfaf62ee.js"><link rel="prefetch" href="/assets/js/13.bbb29b3e.js"><link rel="prefetch" href="/assets/js/14.7ad4e45b.js"><link rel="prefetch" href="/assets/js/15.a5e7f973.js"><link rel="prefetch" href="/assets/js/16.534170d4.js"><link rel="prefetch" href="/assets/js/17.ef4f525b.js"><link rel="prefetch" href="/assets/js/18.47a6b1c2.js"><link rel="prefetch" href="/assets/js/19.cedc1cce.js"><link rel="prefetch" href="/assets/js/20.1ffe1c47.js"><link rel="prefetch" href="/assets/js/21.f2cdc78f.js"><link rel="prefetch" href="/assets/js/22.d7e1abe0.js"><link rel="prefetch" href="/assets/js/23.fd84a8b5.js"><link rel="prefetch" href="/assets/js/24.d59ee447.js"><link rel="prefetch" href="/assets/js/25.8f5c9bbd.js"><link rel="prefetch" href="/assets/js/26.b9299e08.js"><link rel="prefetch" href="/assets/js/27.d2b9cc7a.js"><link rel="prefetch" href="/assets/js/28.78d33527.js"><link rel="prefetch" href="/assets/js/29.4a658e0d.js"><link rel="prefetch" href="/assets/js/3.5e52e679.js"><link rel="prefetch" href="/assets/js/30.2b1cec26.js"><link rel="prefetch" href="/assets/js/31.07d40c89.js"><link rel="prefetch" href="/assets/js/32.8fc4a727.js"><link rel="prefetch" href="/assets/js/33.95013e87.js"><link rel="prefetch" href="/assets/js/34.ef3c89a4.js"><link rel="prefetch" href="/assets/js/35.5550c81e.js"><link rel="prefetch" href="/assets/js/36.325eb3ab.js"><link rel="prefetch" href="/assets/js/37.b2ed41a4.js"><link rel="prefetch" href="/assets/js/38.447431d3.js"><link rel="prefetch" href="/assets/js/39.5a227a7c.js"><link rel="prefetch" href="/assets/js/4.e98e4ac8.js"><link rel="prefetch" href="/assets/js/5.24f96648.js"><link rel="prefetch" href="/assets/js/6.37e05327.js"><link rel="prefetch" href="/assets/js/7.2532c624.js"><link rel="prefetch" href="/assets/js/8.304c90a0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c15f983.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">冯手力-java学习之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/操作/" class="nav-link">
  操作
</a></div><div class="nav-item"><a href="/工作经验/" class="nav-link">
  工作经验
</a></div><div class="nav-item"><a href="/项目经验/" class="nav-link">
  项目经验
</a></div><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  java知识
</a></div><div class="nav-item"><a href="/数据库/" class="nav-link">
  数据库知识
</a></div><div class="nav-item"><a href="/源码解析/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/算法体系/" class="nav-link">
  算法体系
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/操作/" class="nav-link">
  操作
</a></div><div class="nav-item"><a href="/工作经验/" class="nav-link">
  工作经验
</a></div><div class="nav-item"><a href="/项目经验/" class="nav-link">
  项目经验
</a></div><div class="nav-item"><a href="/java/" class="nav-link router-link-active">
  java知识
</a></div><div class="nav-item"><a href="/数据库/" class="nav-link">
  数据库知识
</a></div><div class="nav-item"><a href="/源码解析/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/算法体系/" class="nav-link">
  算法体系
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/java/" aria-current="page" class="sidebar-link">java底层基础知识</a></li><li><a href="/java/java_base.html" class="sidebar-link">java关键字</a></li><li><a href="/java/lambda.html" class="sidebar-link">lambda</a></li><li><a href="/java/juc.html" class="sidebar-link">JUC</a></li><li><a href="/java/Kafka.html" class="sidebar-link">Kafka</a></li><li><a href="/java/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/java/Redis.html" aria-current="page" class="active sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/Redis.html#一-redis知识点总结" class="sidebar-link">一.redis知识点总结</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_1-redis是单线程吗" class="sidebar-link">1.redis是单线程吗</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_2-击穿-穿透-雪崩" class="sidebar-link">2.击穿,穿透,雪崩.</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_3-akf分治" class="sidebar-link">3.AKF分治</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_4-redis和zookeeper怎么选" class="sidebar-link">4.Redis和ZooKeeper怎么选</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#二-redis系统学习" class="sidebar-link">二.redis系统学习</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_1-什么是redis" class="sidebar-link">1.什么是Redis?</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#击穿-穿透-雪崩" class="sidebar-link">击穿,穿透,雪崩</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/Redis.html#_1-击穿" class="sidebar-link">1.击穿</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_2-穿透" class="sidebar-link">2. 穿透</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#_3-雪崩" class="sidebar-link">3.雪崩</a></li><li class="sidebar-sub-header"><a href="/java/Redis.html#要有全局感" class="sidebar-link">要有全局感</a></li></ul></li><li class="sidebar-sub-header"><a href="/java/Redis.html#redis面试经验" class="sidebar-link">redis面试经验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/Redis.html#redis常见面试题解析" class="sidebar-link">redis常见面试题解析</a></li></ul></li></ul></li><li><a href="/java/spring.html" class="sidebar-link">spring知识汇总</a></li><li><a href="/java/SpringBoot.html" class="sidebar-link">SpringBoot</a></li><li><a href="/java/SpringCloud.html" class="sidebar-link">SpringCloud学习</a></li><li><a href="/java/总结的题目.html" class="sidebar-link">总结的题目</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="一-redis知识点总结"><a href="#一-redis知识点总结" class="header-anchor">#</a> 一.redis知识点总结</h2> <h2 id="_1-redis是单线程吗"><a href="#_1-redis是单线程吗" class="header-anchor">#</a> 1.redis是单线程吗</h2> <p>1，无论什么版本，工作线程就是一个<br>
2，6.x高版本出现了IO多线程<br>
3，使用上来说，没有变化<br>
4,  IO多线程,把输入/输出放到更多的线程里去并行，好处如下：1，执行时间缩短，更快；2，更好的压榨系统及硬件的资源(网卡能够高效的使用)；</p> <p><img src="/assets/img/redis1.4b82a66a.jpg" alt="redis线程"></p> <h2 id="_2-击穿-穿透-雪崩"><a href="#_2-击穿-穿透-雪崩" class="header-anchor">#</a> 2.击穿,穿透,雪崩.</h2> <p><img src="/assets/img/reids2-1.532beb99.jpg" alt="2-1"></p> <p><img src="/assets/img/redis2-2.d94e394c.jpg" alt="2-2"></p> <h2 id="_3-akf分治"><a href="#_3-akf分治" class="header-anchor">#</a> 3.AKF分治</h2> <p><a href="https://blog.csdn.net/yueaini10000/article/details/109444808" target="_blank" rel="noopener noreferrer">AKF分治<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>图解:</p> <p><img src="/assets/img/redis_AKF.da5987c3.jpg" alt="AKF"></p> <h2 id="_4-redis和zookeeper怎么选"><a href="#_4-redis和zookeeper怎么选" class="header-anchor">#</a> 4.Redis和ZooKeeper怎么选</h2> <p><a href="https://blog.csdn.net/shiyuezhong/article/details/96098728" target="_blank" rel="noopener noreferrer">Redis和ZooKeeper怎么选<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="二-redis系统学习"><a href="#二-redis系统学习" class="header-anchor">#</a> 二.redis系统学习</h2> <h2 id="_1-什么是redis"><a href="#_1-什么是redis" class="header-anchor">#</a> 1.什么是Redis?</h2> <p><a href="http://redis.cn/" target="_blank" rel="noopener noreferrer">redis中文官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://redis.io/" target="_blank" rel="noopener noreferrer">redis英文官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。</p> <p>它支持多种类型的数据结构，如    	    <a href="http://redis.cn/topics/data-types-intro.html#strings" target="_blank" rel="noopener noreferrer">字符串（strings）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/data-types-intro.html#hashes" target="_blank" rel="noopener noreferrer">散列（hashes）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/data-types-intro.html#lists" target="_blank" rel="noopener noreferrer">列表（lists）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/data-types-intro.html#sets" target="_blank" rel="noopener noreferrer">集合（sets）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/data-types-intro.html#sorted-sets" target="_blank" rel="noopener noreferrer">有序集合（sorted sets）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 与范围查询，    <a href="http://redis.cn/topics/data-types-intro.html#bitmaps" target="_blank" rel="noopener noreferrer">bitmaps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/data-types-intro.html#hyperloglogs" target="_blank" rel="noopener noreferrer">hyperloglogs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和     <a href="http://redis.cn/commands/geoadd.html" target="_blank" rel="noopener noreferrer">地理空间（geospatial）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 索引半径查询。     Redis 内置了    <a href="http://redis.cn/topics/replication.html" target="_blank" rel="noopener noreferrer">复制（replication）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="http://redis.cn/commands/eval.html" target="_blank" rel="noopener noreferrer">LUA脚本（Lua scripting）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    <a href="http://redis.cn/topics/lru-cache.html" target="_blank" rel="noopener noreferrer">LRU驱动事件（LRU eviction）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<a href="http://redis.cn/topics/transactions.html" target="_blank" rel="noopener noreferrer">事务（transactions）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>    和不同级别的    <a href="http://redis.cn/topics/persistence.html" target="_blank" rel="noopener noreferrer">磁盘持久化（persistence）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，    并通过    <a href="http://redis.cn/topics/sentinel.html" target="_blank" rel="noopener noreferrer">Redis哨兵（Sentinel）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和自动    <a href="http://redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener noreferrer">分区（Cluster）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>提供高可用性（high availability）。</p> <h2 id="击穿-穿透-雪崩"><a href="#击穿-穿透-雪崩" class="header-anchor">#</a> 击穿,穿透,雪崩</h2> <h3 id="_1-击穿"><a href="#_1-击穿" class="header-anchor">#</a> 1.击穿</h3> <h4 id="前言"><a href="#前言" class="header-anchor">#</a> 前言:</h4> <p>只有高并发的情况下,才会出现这些问题,否则,小量请求根本不叫事.
真正的客户端,是来源于互联网的那些用户,其实整个网络或者整个项目,用户是造成所有行为的这一端,他们所有的流量压过来之后,如果这一端压力比较大,才会有所谓的高并发,压过来之后,其实一层一层的把这些个流量,全部避掉,最终可能说前面10w个并发,但是经过前面的技术,最终压到数据库就几百,几千,这才是一个架构师看一个项目该做的事情.</p> <h4 id="击穿的发生原理"><a href="#击穿的发生原理" class="header-anchor">#</a> 击穿的发生原理</h4> <p>做缓存的时候,一个k刚好不在了,但是发生了高并发,这就是击穿.</p> <p>做缓存的时候,必然会有两件事</p> <ul><li>key有过期时间,无论如何过期了</li> <li>开启了LRU或者LFU自动把一些相对较冷的数据清除了.留下些热数据.</li></ul> <p>正是因为这两个点,k刚刚被清掉的时候,一大批流量来了,正好请求这个k,这时候他已经没有了,所以这时候,流量一定会掉头去访问数据库,这时候,等于从redis身上打了个窟窿,穿过去了,就叫击穿.</p> <h4 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h4> <h5 id="错误解决方案"><a href="#错误解决方案" class="header-anchor">#</a> 错误解决方案.</h5> <ol><li><p>布隆过滤器,</p> <p>布隆是解决穿透的,不是击穿</p></li> <li><p>延长有效期</p> <p>作为缓存,内存是有限的,不能让更多数据存更久的时间.而且,无论延长多久,就这么巧,就在消失的这个点,击穿了.</p></li></ol> <h5 id="正确解决方案"><a href="#正确解决方案" class="header-anchor">#</a> 正确解决方案.</h5> <p>1.目的是什么,目的是阻止这些高并发流量一下堆到数据库,但是,redis也没有这个k,怎么阻止呢?</p> <p>redis知识点,redis是单进程,单实例,所有的高并发,都是排队进来的,肯定会存在&quot;<strong>第一个人A</strong>&quot;发现了redis不存在,去请求库,然后后面的人都发现了,都去请,这时候可以做件事,A回到客户端,后边的人刚进去找,都没找到,都出来了,然后A又成了第一个,他做一个setnx(),只有不存在的时候才可以设置.让所有人都干了这么个事.</p> <p>A发现了,回来之后,立即创建了个k,就约等于是创建了一把锁,.于是就发生了以下三步.</p> <ol><li>客户端到redis请求,没有那个key,没找到,</li> <li>setnx(),设置锁,只有这步设置成功的哥们,才可去访问数据库,</li> <li>只有获得锁的人才能访问数据库.</li></ol> <p>代码逻辑就是这样,锁成功的人去请求,失败的人等待一下再来请求.1.getkey,2.失败,都去setnx(),3-1成功的人去访问数据库,3-2失败的人睡眠一会,醒了之后,从1开始.</p> <p>2.衍生问题:</p> <p>2-1. 睡多久合适</p> <blockquote><p>其实你要评测下,从你的服务访问数据库平均损耗多少毫秒,这个不能让他们睡很久,几秒钟的话,前面的整个所有链就超时了,</p></blockquote> <p>2-2.最主要的问题.发生死锁.</p> <blockquote><p>&quot;<strong>第一个人A</strong>&quot;,锁上了,忙事去了,结果他挂了,锁在那放着,没人把请求补上去,其他的高并发请求就一直循环在那睡.所以,这个锁,不能是死锁,得是活锁,</p> <p>没错,锁也是可以设置超时时间的,我们给锁设置一个过期时间,比如1s,(不短了),这时候,即使他挂了,1s后,别的请求看到锁没了,k也没有,还有个人可以重新上锁去请求,由下个人替补去取这个数据.</p> <p>但是但是但是!!!!,分布式中,最头疼的,就是大家都是分开的,过期时间怎么设置,长了,刚开始就挂了,别人要浪费很多时间,短了,他没干完事呢,锁就过期了,他没更新数据呢.别人又来了,还是一样拥塞着.其实看上去好像没多大问题.就是第一个出来了,还有几个在那拥塞着呢,就在那等.所以可能造成几个客户延迟,丢失等.
怎么解决呢?多线程!一个线程去取DB,另一个线程去监控他取回来没有,然后更新,延长锁的时间.这时候,多加一个更新线程,即使第一个哥们挂了,锁可能会超时,那么这个就靠超时来解决,第一个没挂, 他时间延长了,他不会造成别人排队干这个事.是一个解决方案.但是代码逻辑复杂度提高.</p></blockquote> <h3 id="_2-穿透"><a href="#_2-穿透" class="header-anchor">#</a> 2. 穿透</h3> <h4 id="前言-2"><a href="#前言-2" class="header-anchor">#</a> 前言:</h4> <p>只有作为缓存才有这个问题.</p> <h4 id="穿透发生原理"><a href="#穿透发生原理" class="header-anchor">#</a> 穿透发生原理</h4> <p>击穿,说的是一个k刚好不在了,然后要去数据库取,穿透呢,指的是你查的根本就是一个连数据库中都不存在的数据,甭说缓存没有,数据库都没有.但是呢,业务里,缓存没有,全都压到数据库,再去做查询的话,也是消耗性能.</p> <h4 id="解决方案-2"><a href="#解决方案-2" class="header-anchor">#</a> 解决方案</h4> <p>布隆过滤器,当然,那也是有几种使用方法的.</p> <ol><li><p>客户端里植入布隆过滤器的相应算法,让所有客户端就包含了,如果客户端就包含了布隆,以及缓存了一些数据的话,这意味着,连redis的压力都没了.</p> <blockquote><p>优点:</p> <blockquote><p>如果客户端包含过滤逻辑,那么一定会过滤部分请求,减少压力,到不了redis.</p></blockquote> <p>缺点:</p> <blockquote><p>对客户端内存要求比较大</p></blockquote></blockquote></li> <li><p>客户端只有算法,布隆过滤器的bitmap还是在redis中,</p></li> <li><p>redis中集成布隆模块,变成一个个指令,</p> <blockquote><p>优点:</p> <blockquote><p>客户端变得简单</p></blockquote> <p>缺点:</p> <blockquote><p>所有东西都压到了redis</p></blockquote></blockquote></li></ol> <p>布隆过滤器有一个缺点:<font color="red">布隆过滤器只能增加,不能删除.!!!</font>,如果你业务中,大量数据增删改时候,有些数据被删掉,这时候你只能往里增,那么代表着,布隆一查有,结果没有了,到数据库了,你要么给他置空,要么换一个,比如布谷鸟或者布隆过滤器+,能支持删除的.置空的话,反正redis查的时候,就返回了,也不会触发布隆那个环节,总之,既能用到布隆过滤器,组织流量到达他, 也得支持数据的变化.</p> <h3 id="_3-雪崩"><a href="#_3-雪崩" class="header-anchor">#</a> 3.雪崩</h3> <h4 id="前言-3"><a href="#前言-3" class="header-anchor">#</a> 前言:</h4> <p>也是只有作为缓存的时候,才考虑这个问题.</p> <h4 id="雪崩发生原理"><a href="#雪崩发生原理" class="header-anchor">#</a> 雪崩发生原理</h4> <p>有点像击穿,击穿是一个k不见了,导致压到数据库,但是这个问题,好像并不是那么容易发生,反而雪崩,处理不好反而更容易发生.</p> <p>什么时候产生雪崩?是大量的k同时失效,自己同时过期,比如半夜12点,新的一天,老的全部过期,这样会造成大量的k同时失效,这时候,间接导致大量请求到达了数据库,这种场景更真实一点,均匀每个k被几十几百请求,全压过去了.怎么解决?</p> <h4 id="解决方案-3"><a href="#解决方案-3" class="header-anchor">#</a> 解决方案</h4> <h5 id="错误解决方案-2"><a href="#错误解决方案-2" class="header-anchor">#</a> 错误解决方案:</h5> <p>均匀分布过期时间.</p> <p>为什么?刚刚说过了,雪崩如何产生的,某个时间点,大量k同时过期,注意看,某个时间点,大量k,某个时间点!!!就是说,在那个点,老的k必须换掉,新的k必须压上来,你均匀分布过期了,老的k没换掉,就会产生脏读,这是很危险的,</p> <h5 id="正确解决方案-2"><a href="#正确解决方案-2" class="header-anchor">#</a> 正确解决方案:</h5> <p>你要分开场景说,如果跟时点性无所谓,那么就是时间没调好,可以用过期时间这个事了,但是如果某个点必须过期,就不要用它了,那么这种某点必须过期,怎么处理呢.</p> <p>强依赖击穿方案.</p> <p>如果你整个框架都知道,这些数据会在某个点过期,你可以在业务中加个前置.加个判断,叫做零点延迟.</p> <p>什么意思呢.?你的业务,到了那个点了,将请求都随机睡一下,不要把流量都放过来,有了这个延迟,就可以把流量到达的时间不一样.这时候,阻塞不会大,流量也变小,后面人来的时候,前面的人已经更新完了,</p> <h3 id="要有全局感"><a href="#要有全局感" class="header-anchor">#</a> 要有全局感</h3> <p>你会选择在不同的点上尽量的限流,把流量控制住,越往后到达越少,越精准.</p> <h2 id="redis面试经验"><a href="#redis面试经验" class="header-anchor">#</a> redis面试经验</h2> <h3 id="redis常见面试题解析"><a href="#redis常见面试题解析" class="header-anchor">#</a> redis常见面试题解析</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/设计模式.html" class="prev">
        设计模式
      </a></span> <span class="next"><a href="/java/spring.html">
        spring知识汇总
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.18fa8910.js" defer></script><script src="/assets/js/2.d4087e47.js" defer></script><script src="/assets/js/9.3ca4f0e3.js" defer></script>
  </body>
</html>
